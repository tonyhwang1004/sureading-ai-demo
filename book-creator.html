<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š ì±… ë§Œë“¤ì–´ì¤˜ - Sue Reading Academy</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding-top: 60px;
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        
        .creator-header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .academy-logo {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .creator-form {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .form-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .form-section:last-child {
            border-bottom: none;
        }
        
        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #667eea;
            outline: none;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .template-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .template-card:hover, .template-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .template-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(45deg, #28a745, #20c997);
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .result-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .back-button {
            position: absolute;
            top: 80px;
            left: 20px;
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .template-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">â† Sue Reading Academy</a>
    
    <div class="container">
        <div class="creator-header">
            <div class="academy-logo">ğŸ“š ì±… ë§Œë“¤ì–´ì¤˜</div>
            <h1>Sue Reading Academy ìë™ ì±… ìƒì„± ì‹œìŠ¤í…œ</h1>
            <p>ì„ ìƒë‹˜ì´ ì›í•˜ëŠ” ì˜ì–´ ë„ì„œì™€ AI ë¬¸ì œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤</p>
        </div>

        <div class="creator-form">
            <form id="book-creator-form">
                <!-- 1. í…œí”Œë¦¿ ì„ íƒ -->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ¯ <span>1ë‹¨ê³„: ì±… í…œí”Œë¦¿ ì„ íƒ</span>
                    </div>
                    
                    <div class="template-grid">
                        <div class="template-card" data-template="story">
                            <div class="template-icon">ğŸ“–</div>
                            <h4>ìŠ¤í† ë¦¬ë¶</h4>
                            <p>ì´ì•¼ê¸° ì¤‘ì‹¬ì˜ ì½ê¸° êµì¬</p>
                        </div>
                        <div class="template-card" data-template="educational">
                            <div class="template-icon">ğŸ§ </div>
                            <h4>êµìœ¡ìë£Œ</h4>
                            <p>í•™ìŠµ ëª©ì ì˜ ì •ë³´ ì „ë‹¬</p>
                        </div>
                        <div class="template-card" data-template="conversation">
                            <div class="template-icon">ğŸ’¬</div>
                            <h4>ëŒ€í™”í˜•</h4>
                            <p>ëŒ€í™” ì¤‘ì‹¬ì˜ ì‹¤ìš© ì˜ì–´</p>
                        </div>
                        <div class="template-card" data-template="science">
                            <div class="template-icon">ğŸ”¬</div>
                            <h4>ê³¼í•™/ì •ë³´</h4>
                            <p>ê³¼í•™ ì§€ì‹ ì „ë‹¬ êµì¬</p>
                        </div>
                    </div>
                    
                    <input type="hidden" id="selected-template" name="template" required>
                </div>

                <!-- 2. ê¸°ë³¸ ì •ë³´ -->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ“‹ <span>2ë‹¨ê³„: ì±… ê¸°ë³¸ ì •ë³´</span>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="book-title">ì±… ì œëª©</label>
                            <input type="text" id="book-title" name="title" required 
                                   placeholder="ì˜ˆ: The Magic Forest Adventure">
                        </div>
                        <div class="form-group">
                            <label for="book-author">ì €ìëª…</label>
                            <input type="text" id="book-author" name="author" required 
                                   placeholder="ì˜ˆ: Sue Reading Academy">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="book-level">ë ˆë²¨</label>
                            <select id="book-level" name="level" required>
                                <option value="">ë ˆë²¨ ì„ íƒ</option>
                                <option value="level1">Level 1 (ì´ˆê¸‰)</option>
                                <option value="level2">Level 2 (ì´ˆì¤‘ê¸‰)</option>
                                <option value="level3">Level 3 (ì¤‘ê¸‰)</option>
                                <option value="level4">Level 4 (ì¤‘ê³ ê¸‰)</option>
                                <option value="level5">Level 5 (ê³ ê¸‰)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="book-words">ëª©í‘œ ë‹¨ì–´ ìˆ˜</label>
                            <select id="book-words" name="words" required>
                                <option value="">ë‹¨ì–´ ìˆ˜ ì„ íƒ</option>
                                <option value="500">500ë‹¨ì–´ (ì§§ì€ ì´ì•¼ê¸°)</option>
                                <option value="1000">1,000ë‹¨ì–´ (ë³´í†µ ì´ì•¼ê¸°)</option>
                                <option value="2000">2,000ë‹¨ì–´ (ê¸´ ì´ì•¼ê¸°)</option>
                                <option value="3000">3,000ë‹¨ì–´ (ì¥í¸)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="book-summary">ì±… ìš”ì•½ ë˜ëŠ” ì£¼ì œ</label>
                        <textarea id="book-summary" name="summary" required 
                                  placeholder="ì˜ˆ: ë§ˆë²•ì˜ ìˆ²ì—ì„œ ëª¨í—˜ì„ ë– ë‚˜ëŠ” ì–´ë¦°ì´ì˜ ì´ì•¼ê¸°. ìš©ê¸°ì™€ ìš°ì •ì˜ ê°€ì¹˜ë¥¼ ë°°ìš¸ ìˆ˜ ìˆëŠ” ë‚´ìš©."></textarea>
                    </div>
                </div>

                <!-- 3. AI ë¬¸ì œ ì„¤ì • -->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ¤– <span>3ë‹¨ê³„: AI ë¬¸ì œ ìƒì„± ì„¤ì •</span>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="question-count">ìƒì„±í•  ë¬¸ì œ ìˆ˜</label>
                            <select id="question-count" name="questionCount" required>
                                <option value="10">10ë¬¸ì œ (ê¸°ë³¸)</option>
                                <option value="15">15ë¬¸ì œ (í‘œì¤€)</option>
                                <option value="20">20ë¬¸ì œ (ë§ìŒ)</option>
                                <option value="25">25ë¬¸ì œ (ë§¤ìš° ë§ìŒ)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="difficulty-focus">ë‚œì´ë„ ì¤‘ì </label>
                            <select id="difficulty-focus" name="difficulty" required>
                                <option value="mixed">í˜¼í•© (ì¶”ì²œ)</option>
                                <option value="easy">ì‰¬ì›€ ì¤‘ì‹¬</option>
                                <option value="medium">ë³´í†µ ì¤‘ì‹¬</option>
                                <option value="hard">ì–´ë ¤ì›€ ì¤‘ì‹¬</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ë¬¸ì œ ìœ í˜• ì„ íƒ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 5px; font-weight: normal;">
                                <input type="checkbox" name="questionTypes" value="vocabulary" checked> ì–´íœ˜ ì´í•´
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; font-weight: normal;">
                                <input type="checkbox" name="questionTypes" value="factual" checked> ì‚¬ì‹¤ ì´í•´
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; font-weight: normal;">
                                <input type="checkbox" name="questionTypes" value="inference" checked> ì¶”ë¡  ì´í•´
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; font-weight: normal;">
                                <input type="checkbox" name="questionTypes" value="critical" checked> ë¹„íŒì  ì‚¬ê³ 
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; font-weight: normal;">
                                <input type="checkbox" name="questionTypes" value="synthesis" checked> ì¢…í•© ì´í•´
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 4. ìƒì„± ë²„íŠ¼ -->
                <div class="form-section">
                    <div class="section-title">
                        ğŸš€ <span>4ë‹¨ê³„: ì±…ê³¼ ë¬¸ì œ ìƒì„±</span>
                    </div>
                    
                    <div class="progress-bar" id="progress-bar" style="display: none;">
                        <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button type="submit" class="btn btn-primary" style="font-size: 1.2rem; padding: 15px 40px;">
                            ğŸ“š ì±… ë§Œë“¤ì–´ì¤˜! (AI ìë™ ìƒì„±)
                        </button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 15px; color: #666; font-size: 0.9rem;">
                        â±ï¸ ì˜ˆìƒ ì†Œìš”ì‹œê°„: 30ì´ˆ ~ 1ë¶„<br>
                        ğŸ¤– AIê°€ ë§ì¶¤í˜• ì˜ì–´ ë„ì„œì™€ ë¬¸ì œë¥¼ ìë™ ìƒì„±í•©ë‹ˆë‹¤
                    </div>
                </div>
            </form>
        </div>

        <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
        <div class="result-section" id="result-section">
            <h2>ğŸ‰ ì±… ìƒì„± ì™„ë£Œ!</h2>
            <div id="generation-results"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-success" onclick="downloadBook()">ğŸ“¥ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
                <button class="btn btn-primary" onclick="addToLibrary()">ğŸ“š ë„ì„œê´€ì— ì¶”ê°€</button>
                <button class="btn btn-secondary" onclick="createNewBook()">ğŸ”„ ìƒˆ ì±… ë§Œë“¤ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="static/js/user-manager.js"></script>
    
    <script>
        let selectedTemplate = null;
        let generatedBook = null;

        // í…œí”Œë¦¿ ì„ íƒ ì²˜ë¦¬
        document.querySelectorAll('.template-card').forEach(card => {
            card.addEventListener('click', function() {
                // ì´ì „ ì„ íƒ í•´ì œ
                document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
                
                // ìƒˆ ì„ íƒ ì ìš©
                this.classList.add('selected');
                selectedTemplate = this.dataset.template;
                document.getElementById('selected-template').value = selectedTemplate;
                
                console.log(`í…œí”Œë¦¿ ì„ íƒ: ${selectedTemplate}`);
            });
        });

        // í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('book-creator-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!selectedTemplate) {
                alert('â— ì±… í…œí”Œë¦¿ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const formData = new FormData(this);
            const bookData = {
                template: selectedTemplate,
                title: formData.get('title'),
                author: formData.get('author'),
                level: formData.get('level'),
                words: parseInt(formData.get('words')),
                summary: formData.get('summary'),
                questionCount: parseInt(formData.get('questionCount')),
                difficulty: formData.get('difficulty'),
                questionTypes: formData.getAll('questionTypes')
            };
            
            console.log('ğŸ“š ì±… ìƒì„± ìš”ì²­:', bookData);
            
            // ìƒì„± ì‹œì‘
            await generateBook(bookData);
        });

        async function generateBook(bookData) {
            // ì§„í–‰ í‘œì‹œ
            showProgress();
            
            try {
                // 1ë‹¨ê³„: ì±… ID ìƒì„±
                updateProgress(20, 'ğŸ“‹ ì±… ì •ë³´ ì„¤ì • ì¤‘...');
                const bookId = generateBookId(bookData.title);
                
                // 2ë‹¨ê³„: ì±… ë°ì´í„° êµ¬ì¡° ìƒì„±
                updateProgress(40, 'ğŸ“– ì±… êµ¬ì¡° ìƒì„± ì¤‘...');
                await sleep(500);
                
                const book = createBookStructure(bookId, bookData);
                
                // 3ë‹¨ê³„: AI ë¬¸ì œ ìƒì„±
                updateProgress(60, 'ğŸ¤– AI ë¬¸ì œ ìƒì„± ì¤‘...');
                await sleep(1000);
                
                const questions = generateAIQuestions(bookId, bookData);
                
                // 4ë‹¨ê³„: íŒŒì¼ ìƒì„±
                updateProgress(80, 'ğŸ“ íŒŒì¼ ìƒì„± ì¤‘...');
                await sleep(500);
                
                generatedBook = {
                    book: book,
                    questions: questions,
                    bookData: bookData
                };
                
                // 5ë‹¨ê³„: ì™„ë£Œ
                updateProgress(100, 'âœ… ìƒì„± ì™„ë£Œ!');
                await sleep(300);
                
                showResults();
                
            } catch (error) {
                console.error('ì±… ìƒì„± ì˜¤ë¥˜:', error);
                alert('âŒ ì±… ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                hideProgress();
            }
        }

        function generateBookId(title) {
            // ì œëª©ì„ ê¸°ë°˜ìœ¼ë¡œ ê³ ìœ  ID ìƒì„±
            const words = title.split(' ');
            const prefix = words.slice(0, 2).map(word => 
                word.charAt(0).toUpperCase()
            ).join('');
            const timestamp = Date.now().toString().slice(-3);
            return prefix + timestamp;
        }

        function createBookStructure(bookId, bookData) {
            return {
                id: bookId,
                title: bookData.title,
                author: bookData.author,
                words: bookData.words,
                cover: getRandomEmoji(bookData.template),
                coverColor: getRandomColor(),
                summary: bookData.summary,
                level: bookData.level,
                template: bookData.template,
                createdAt: new Date().toISOString(),
                createdBy: userManager.currentUser?.name || 'Sue Reading Academy'
            };
        }

        function generateAIQuestions(bookId, bookData) {
            const questions = {
                bookId: bookId,
                metadata: {
                    totalQuestions: bookData.questionCount,
                    difficulty: bookData.difficulty,
                    types: bookData.questionTypes,
                    generatedAt: new Date().toISOString(),
                    generatedBy: 'Sue Reading Academy AI'
                },
                chapters: {
                    "chapter1": {
                        chapterTitle: `${bookData.title} - Reading Comprehension`,
                        questions: []
                    }
                }
            };

            // AI ë¬¸ì œ ìƒì„± (í…œí”Œë¦¿ ê¸°ë°˜)
            for (let i = 0; i < bookData.questionCount; i++) {
                const questionType = bookData.questionTypes[i % bookData.questionTypes.length];
                const question = generateQuestionByType(questionType, bookData, i + 1);
                questions.chapters.chapter1.questions.push(question);
            }

            return questions;
        }

        function generateQuestionByType(type, bookData, questionNum) {
            const templates = {
                vocabulary: {
                    questions: [
                        `What does the word "[WORD]" mean in the context of ${bookData.title}?`,
                        `Which word best describes the main character's feeling?`,
                        `What is the meaning of "[WORD]" as used in the story?`
                    ],
                    options: [
                        ["Happy", "Sad", "Excited", "Worried"],
                        ["Big", "Small", "Beautiful", "Scary"],
                        ["Fast", "Slow", "Careful", "Dangerous"]
                    ]
                },
                factual: {
                    questions: [
                        `Where does the story in ${bookData.title} take place?`,
                        `What happens at the beginning of the story?`,
                        `Who are the main characters in ${bookData.title}?`
                    ],
                    options: [
                        ["In a forest", "In a city", "At school", "At home"],
                        ["The character goes to sleep", "The character meets a friend", "The character finds something", "The character gets lost"],
                        ["A boy and a girl", "A teacher and students", "A family", "Friends"]
                    ]
                },
                inference: {
                    questions: [
                        `Why do you think the main character made that choice?`,
                        `What can we infer about the character's personality?`,
                        `What might happen next in the story?`
                    ],
                    options: [
                        ["Because they were brave", "Because they were scared", "Because they were curious", "Because they were tired"],
                        ["They are kind", "They are mean", "They are funny", "They are serious"],
                        ["They will go home", "They will continue the adventure", "They will meet someone new", "They will solve the problem"]
                    ]
                },
                critical: {
                    questions: [
                        `Do you agree with the main character's decision? Why?`,
                        `What would you do differently in this situation?`,
                        `What lesson can we learn from ${bookData.title}?`
                    ],
                    options: [
                        ["Yes, it was the right choice", "No, there was a better way", "Partially, but could be improved", "It depends on the situation"],
                        ["Be more careful", "Ask for help", "Think before acting", "Trust my friends"],
                        ["Always be brave", "Friends are important", "Hard work pays off", "Be kind to others"]
                    ]
                },
                synthesis: {
                    questions: [
                        `How does this story connect to real life?`,
                        `What is the main theme of ${bookData.title}?`,
                        `How do all the events in the story work together?`
                    ],
                    options: [
                        ["It teaches us about friendship", "It shows us how to be brave", "It helps us understand family", "It explains how to solve problems"],
                        ["Adventure and discovery", "Love and family", "Learning and growth", "Helping others"],
                        ["Each event leads to the next", "They all teach the same lesson", "They show character development", "They build excitement"]
                    ]
                }
            };

            const template = templates[type];
            const questionIndex = Math.floor(Math.random() * template.questions.length);
            const question = template.questions[questionIndex];
            const options = template.options[questionIndex];
            const correctAnswer = Math.floor(Math.random() * 4);

            return {
                question: question.replace('[WORD]', getRandomWord()),
                options: options,
                answer: correctAnswer,
                explanation: `This is a ${type} question that helps students understand the story better. The correct answer helps develop reading comprehension skills.`,
                type: type,
                difficulty: bookData.difficulty,
                questionNumber: questionNum
            };
        }

        function getRandomWord() {
            const words = ['adventure', 'journey', 'discovery', 'friendship', 'courage', 'magical', 'wonderful', 'exciting'];
            return words[Math.floor(Math.random() * words.length)];
        }

        function getRandomEmoji(template) {
            const emojis = {
                story: ['ğŸ“š', 'ğŸ“–', 'ğŸ“', 'âœ¨', 'ğŸŒŸ'],
                educational: ['ğŸ§ ', 'ğŸ“', 'ğŸ“Š', 'ğŸ’¡', 'ğŸ”'],
                conversation: ['ğŸ’¬', 'ğŸ—£ï¸', 'ğŸ‘¥', 'ğŸ¤', 'ğŸ’­'],
                science: ['ğŸ”¬', 'âš—ï¸', 'ğŸ§ª', 'ğŸŒ', 'ğŸ”­']
            };
            const emojiList = emojis[template] || emojis.story;
            return emojiList[Math.floor(Math.random() * emojiList.length)];
        }

        function getRandomColor() {
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57', '#FF9FF3', '#54A0FF', '#5F27CD'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function showProgress() {
            document.getElementById('progress-bar').style.display = 'block';
            document.querySelector('button[type="submit"]').disabled = true;
        }

        function updateProgress(percent, message) {
            document.getElementById('progress-fill').style.width = percent + '%';
            console.log(`ì§„í–‰ë¥ : ${percent}% - ${message}`);
        }

        function hideProgress() {
            document.getElementById('progress-bar').style.display = 'none';
            document.querySelector('button[type="submit"]').disabled = false;
        }

        function showResults() {
            hideProgress();
            
            const resultsHtml = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 3rem; margin-bottom: 15px;">${generatedBook.book.cover}</div>
                    <h3>${generatedBook.book.title}</h3>
                    <p>by ${generatedBook.book.author}</p>
                    <div style="margin: 15px 0;">
                        <span style="background: #e3f2fd; padding: 5px 10px; border-radius: 15px; margin: 0 5px;">
                            ${generatedBook.book.level}
                        </span>
                        <span style="background: #f3e5f5; padding: 5px 10px; border-radius: 15px; margin: 0 5px;">
                            ${generatedBook.book.words} ë‹¨ì–´
                        </span>
                        <span style="background: #e8f5e8; padding: 5px 10px; border-radius: 15px; margin: 0 5px;">
                            ${generatedBook.questions.metadata.totalQuestions} ë¬¸ì œ
                        </span>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4>ğŸ“Š ìƒì„±ëœ ì½˜í…ì¸  ì •ë³´:</h4>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li><strong>ì±… ID:</strong> ${generatedBook.book.id}</li>
                        <li><strong>í…œí”Œë¦¿:</strong> ${generatedBook.book.template}</li>
                        <li><strong>ë¬¸ì œ ìœ í˜•:</strong> ${generatedBook.bookData.questionTypes.join(', ')}</li>
                        <li><strong>ë‚œì´ë„:</strong> ${generatedBook.bookData.difficulty}</li>
                        <li><strong>ìƒì„± ì‹œê°„:</strong> ${new Date().toLocaleString()}</li>
                    </ul>
                </div>
                
                <div style="background: #e8f5e8; padding: 15px; border-radius: 10px; margin: 20px 0;">
                    <h4>âœ… Sue Reading Academyì— ë°”ë¡œ ì¶”ê°€ ê°€ëŠ¥!</h4>
                    <p>ìƒì„±ëœ ì±…ê³¼ AI ë¬¸ì œë¥¼ ì–´í•™ì› ì‹œìŠ¤í…œì— ì¦‰ì‹œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            `;
            
            document.getElementById('generation-results').innerHTML = resultsHtml;
            document.getElementById('result-section').style.display = 'block';
            
            // ê²°ê³¼ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
        }

        function downloadBook() {
            const bookJson = JSON.stringify(generatedBook.book, null, 2);
            const questionsJson = JSON.stringify(generatedBook.questions, null, 2);
            
            // ì±… ë°ì´í„° ë‹¤ìš´ë¡œë“œ
            downloadFile(`${generatedBook.book.id}.json`, bookJson);
            
            // ë¬¸ì œ ë°ì´í„° ë‹¤ìš´ë¡œë“œ
            downloadFile(`${generatedBook.book.id}_questions.json`, questionsJson);
            
            alert('ğŸ“¥ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!\n\n' +
                  `âœ… ${generatedBook.book.id}.json (ì±… ë°ì´í„°)\n` +
                  `âœ… ${generatedBook.book.id}_questions.json (AI ë¬¸ì œ)`);
        }

        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function addToLibrary() {
            // Sue Reading Academy ì‹œìŠ¤í…œì— ì§ì ‘ ì¶”ê°€
            try {
                // í˜„ì¬ ë°ì´í„°ì— ìƒˆ ì±… ì¶”ê°€
                if (typeof window.SUREADING_DATA !== 'undefined') {
                    // ë ˆë²¨ë³„ ì±… ëª©ë¡ì— ì¶”ê°€
                    const level = generatedBook.book.level;
                    if (!window.SUREADING_DATA.books[level]) {
                        window.SUREADING_DATA.books[level] = [];
                    }
                    window.SUREADING_DATA.books[level].push(generatedBook.book);
                    
                    // ë¬¸ì œ ë°ì´í„° ì¶”ê°€
                    window.SUREADING_DATA.questions[generatedBook.book.id] = generatedBook.questions;
                    
                    // ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸
                    window.SUREADING_DATA.metadata.totalBooks += 1;
                    window.SUREADING_DATA.metadata.totalQuestions += 1;
                    
                    alert('ğŸ“š Sue Reading Academyì— ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n' +
                          `âœ… ì±…: ${generatedBook.book.title}\n` +
                          `âœ… ë¬¸ì œ: ${generatedBook.questions.metadata.totalQuestions}ê°œ\n\n` +
                          'ì´ì œ ë„ì„œ ëª©ë¡ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
                    
                    console.log('ğŸ“š ìƒˆ ì±…ì´ ì‹œìŠ¤í…œì— ì¶”ê°€ë¨:', generatedBook.book.id);
                } else {
                    throw new Error('ì‹œìŠ¤í…œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë„ì„œê´€ ì¶”ê°€ ì˜¤ë¥˜:', error);
                alert('âŒ ë„ì„œê´€ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\níŒŒì¼ ë‹¤ìš´ë¡œë“œë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.');
            }
        }

        function createNewBook() {
            if (confirm('ğŸ”„ ìƒˆë¡œìš´ ì±…ì„ ë§Œë“œì‹œê² ìŠµë‹ˆê¹Œ?\n(í˜„ì¬ ì‘ì—… ë‚´ìš©ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤)')) {
                location.reload();
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì¸ì¦ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            if (!userManager.isLoggedIn()) {
                alert('âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>
