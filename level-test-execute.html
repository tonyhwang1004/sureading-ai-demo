<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sue Reading Academy - Level Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .test-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .test-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .student-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: #333;
        }

        .book-info {
            font-size: 1.1rem;
            color: #667eea;
            font-weight: 600;
        }

        .progress-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.95rem;
            color: #666;
        }

        .timer {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1.1rem;
            min-width: 100px;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .stats-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            text-align: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #666;
        }

        .progress-bar-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 15px 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 1.67%;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            flex: 1;
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .question-number {
            font-size: 1.2rem;
            font-weight: 600;
            color: #667eea;
        }

        .chapter-info {
            background: #f8f9fa;
            color: #495057;
            padding: 6px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .question-text {
            font-size: 1.3rem;
            line-height: 1.6;
            color: #333;
            margin-bottom: 30px;
            font-weight: 500;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 18px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .option:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea15, #764ba215);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }

        .option.correct {
            border-color: #28a745 !important;
            background: linear-gradient(135deg, #28a74515, #20c99715) !important;
        }

        .option.wrong {
            border-color: #dc3545 !important;
            background: linear-gradient(135deg, #dc354515, #c8252515) !important;
        }

        .option-letter {
            width: 40px;
            height: 40px;
            background: #e9ecef;
            color: #495057;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .option.selected .option-letter {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .option.correct .option-letter {
            background: #28a745 !important;
            color: white;
        }

        .option.wrong .option-letter {
            background: #dc3545 !important;
            color: white;
        }

        .option-text {
            flex: 1;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .answer-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .answer-section.show {
            display: block;
        }

        .answer-feedback {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .feedback-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .correct-icon {
            background: #28a745;
        }

        .wrong-icon {
            background: #dc3545;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .nav-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .next-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .submit-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .check-btn {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
            color: white;
        }

        .nav-btn:hover:not(:disabled) {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        @media (max-width: 768px) {
            .test-container {
                padding: 15px;
            }

            .test-header {
                padding: 15px 20px;
                flex-direction: column;
                text-align: center;
            }

            .question-card {
                padding: 25px 20px;
            }

            .navigation {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <!-- 테스트 헤더 -->
        <div class="test-header">
            <div class="test-info">
                <div class="student-name" id="student-name">학생님의 레벨테스트</div>
                <div class="book-info" id="book-info">Magic Tree House by Mary Pope Osborne</div>
                <div class="progress-info">
                    <span>Level <span id="current-level">3</span></span>
                    <span>•</span>
                    <span>문제 <span id="current-question">1</span>/60</span>
                </div>
            </div>
            <div class="timer" id="timer">90:00</div>
        </div>

        <!-- 통계 패널 -->
        <div class="stats-panel">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="answered-count">0</div>
                    <div class="stat-label">답변 완료</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="remaining-count">60</div>
                    <div class="stat-label">남은 문제</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="progress-percent">1.7%</div>
                    <div class="stat-label">진행률</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="current-chapter">Ch.1</div>
                    <div class="stat-label">현재 챕터</div>
                </div>
            </div>
        </div>

        <!-- 진행률 바 -->
        <div class="progress-bar-container">
            <div class="progress-text">
                <span>전체 진행률</span>
                <span id="progress-display">1/60 (1.7%)</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>

        <!-- 문제 카드 -->
        <div class="question-card">
            <div class="question-meta">
                <div class="question-number" id="question-number">문제 1</div>
                <div class="chapter-info" id="chapter-info">Chapter 1</div>
            </div>

            <div class="question-text" id="question-text">
                문제를 불러오는 중...
            </div>

            <div class="options-container" id="options-container">
                <!-- 선택지들이 동적으로 생성됩니다 -->
            </div>

            <!-- 정답 확인 섹션 -->
            <div class="answer-section" id="answer-section">
                <div class="answer-feedback" id="answer-feedback">
                    <!-- 정답/오답 피드백 -->
                </div>
                <div class="explanation" id="explanation">
                    <!-- 설명 -->
                </div>
            </div>
        </div>

        <!-- 네비게이션 -->
        <div class="navigation">
            <button class="nav-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>
                ⬅️ 이전 문제
            </button>

            <div style="text-align: center; color: #666; font-size: 0.9rem;">
                <span id="book-title">Magic Tree House</span>
            </div>

            <button class="nav-btn check-btn" id="check-btn" onclick="checkAnswer()">
                ✅ 정답 확인
            </button>

            <button class="nav-btn next-btn" id="next-btn" onclick="nextQuestion()" style="display: none;">
                다음 문제 ➡️
            </button>
        </div>
    </div>

    <script>
        // ================ 완전한 60문제 데이터 ================
        const allQuestions = [
            // Chapter 1 (12문제)
            { id: 1, chapter: 1, question: "Who are the main characters in Magic Tree House?", options: ["Jack and Jill", "Jack and Annie", "Tom and Annie", "Jack and Sarah"], correct: 1 },
            { id: 2, chapter: 1, question: "Where do Jack and Annie find the tree house?", options: ["In their backyard", "In Frog Creek woods", "At school", "In the park"], correct: 1 },
            { id: 3, chapter: 1, question: "What is special about the tree house?", options: ["Very tall", "Magic - travels through time", "Has toys", "Very old"], correct: 1 },
            { id: 4, chapter: 1, question: "How do Jack and Annie travel in time?", options: ["Close eyes and wish", "Point to picture in book", "Say magic words", "Turn a key"], correct: 1 },
            { id: 5, chapter: 1, question: "What does Jack always carry with him?", options: ["Backpack", "Notebook and pencil", "Camera", "Map"], correct: 1 },
            { id: 6, chapter: 1, question: "How is Jack's personality described?", options: ["Brave and reckless", "Careful and likes to read", "Funny and loud", "Quiet and shy"], correct: 1 },
            { id: 7, chapter: 1, question: "How is Annie's personality described?", options: ["Careful and quiet", "Brave and adventurous", "Scared and nervous", "Smart and serious"], correct: 1 },
            { id: 8, chapter: 1, question: "What happens when they go on their first adventure?", options: ["Get lost", "Meet dinosaurs", "Find treasure", "Get scared"], correct: 1 },
            { id: 9, chapter: 1, question: "What time period do they visit first?", options: ["Medieval times", "Dinosaur era", "Ancient Egypt", "Wild West"], correct: 1 },
            { id: 10, chapter: 1, question: "How do they get back home?", options: ["Walk", "Point to picture of Frog Creek", "Wait for magic", "Call for help"], correct: 1 },
            { id: 11, chapter: 1, question: "What does Jack like to do during adventures?", options: ["Run around", "Take notes", "Collect things", "Sleep"], correct: 1 },
            { id: 12, chapter: 1, question: "Who is more cautious?", options: ["Annie", "Jack", "Both equally", "Neither"], correct: 1 },

            // Chapter 2 (12문제)
            { id: 13, chapter: 2, question: "Where do Jack and Annie go in their second adventure?", options: ["Ancient Egypt", "Medieval castle", "Dinosaur time", "Space"], correct: 1 },
            { id: 14, chapter: 2, question: "What do they wear in medieval times?", options: ["Modern clothes", "Medieval costumes", "Pajamas", "School uniforms"], correct: 1 },
            { id: 15, chapter: 2, question: "Who do they meet at the castle?", options: ["King and Queen", "Knights", "Servants", "All of the above"], correct: 3 },
            { id: 16, chapter: 2, question: "What is happening at the castle?", options: ["Party", "Wedding", "Feast and celebration", "War"], correct: 2 },
            { id: 17, chapter: 2, question: "What does Annie want to do at the castle?", options: ["Leave immediately", "Explore everything", "Hide", "Find food"], correct: 1 },
            { id: 18, chapter: 2, question: "What does Jack worry about?", options: ["Getting home", "Getting in trouble", "Getting lost", "All of the above"], correct: 3 },
            { id: 19, chapter: 2, question: "What do they learn about medieval life?", options: ["Very easy", "Hard and different from today", "Same as today", "Very fun"], correct: 1 },
            { id: 20, chapter: 2, question: "How do people at the castle treat them?", options: ["Ignore them", "Kindly", "Badly", "With suspicion"], correct: 1 },
            { id: 21, chapter: 2, question: "What does Jack write about?", options: ["Nothing", "Everything he sees", "Only scary things", "Only fun things"], correct: 1 },
            { id: 22, chapter: 2, question: "How do they escape danger?", options: ["Run fast", "Hide", "Use the magic tree house", "Fight"], correct: 2 },
            { id: 23, chapter: 2, question: "What do they bring back from medieval times?", options: ["Treasure", "Knowledge and memories", "Clothes", "Food"], correct: 1 },
            { id: 24, chapter: 2, question: "How do they feel about their adventure?", options: ["Scared", "Excited and happy", "Sad", "Angry"], correct: 1 },

            // Chapter 3 (12문제)
            { id: 25, chapter: 3, question: "Where do they travel in their third adventure?", options: ["Ancient Egypt", "Wild West", "Jungle", "Ocean"], correct: 0 },
            { id: 26, chapter: 3, question: "What do they see in ancient Egypt?", options: ["Pyramids", "Pharaohs", "Mummies", "All of the above"], correct: 3 },
            { id: 27, chapter: 3, question: "Who helps them in Egypt?", options: ["Tourist guide", "Egyptian cat", "Pharaoh", "Archaeologist"], correct: 1 },
            { id: 28, chapter: 3, question: "What is the cat's name?", options: ["Fluffy", "Kheti", "Mittens", "Shadow"], correct: 1 },
            { id: 29, chapter: 3, question: "Where does the cat lead them?", options: ["Pyramid", "Palace", "Market", "River"], correct: 0 },
            { id: 30, chapter: 3, question: "What do they find inside the pyramid?", options: ["Gold", "Mummy", "Treasure room", "Secret passages"], correct: 3 },
            { id: 31, chapter: 3, question: "What danger do they face?", options: ["Wild animals", "Getting lost in pyramid", "Angry people", "Sandstorm"], correct: 1 },
            { id: 32, chapter: 3, question: "How does the cat help them?", options: ["Shows them the way", "Protects them", "Brings food", "Calls for help"], correct: 0 },
            { id: 33, chapter: 3, question: "What do they learn about ancient Egypt?", options: ["Building pyramids", "Mummification", "Egyptian culture", "All of the above"], correct: 3 },
            { id: 34, chapter: 3, question: "How do they escape the pyramid?", options: ["Follow the cat", "Use magic", "Dig tunnel", "Call for help"], correct: 0 },
            { id: 35, chapter: 3, question: "What does Jack document?", options: ["Hieroglyphics", "Pyramid structure", "Egyptian customs", "All of the above"], correct: 3 },
            { id: 36, chapter: 3, question: "How do they return to the tree house?", options: ["Walk", "Run", "Cat shows them", "Magic happens"], correct: 2 },

            // Chapter 4 (12문제)
            { id: 37, chapter: 4, question: "What new place do they visit?", options: ["Pirates' ship", "Amazon rainforest", "Space station", "Underwater"], correct: 1 },
            { id: 38, chapter: 4, question: "What animals do they meet in the rainforest?", options: ["Monkeys", "Birds", "Insects", "All of the above"], correct: 3 },
            { id: 39, chapter: 4, question: "What is their mission in the rainforest?", options: ["Find treasure", "Help scientist", "Rescue animals", "Find magical flower"], correct: 1 },
            { id: 40, chapter: 4, question: "Who do they meet in the rainforest?", options: ["Explorer", "Scientist", "Native people", "All of the above"], correct: 3 },
            { id: 41, chapter: 4, question: "What danger threatens the rainforest?", options: ["Fire", "Cutting down trees", "Pollution", "All of the above"], correct: 3 },
            { id: 42, chapter: 4, question: "How do the animals communicate?", options: ["Words", "Sounds and signals", "Writing", "Telepathy"], correct: 1 },
            { id: 43, chapter: 4, question: "What does Annie discover about animals?", options: ["They're scary", "They're friendly and intelligent", "They're dangerous", "They're boring"], correct: 1 },
            { id: 44, chapter: 4, question: "What does Jack learn about ecosystems?", options: ["Nothing important", "Everything is connected", "Only about trees", "Only about animals"], correct: 1 },
            { id: 45, chapter: 4, question: "How do they help in the rainforest?", options: ["Plant trees", "Save animals", "Spread awareness", "All of the above"], correct: 3 },
            { id: 46, chapter: 4, question: "What weather challenges do they face?", options: ["Rain", "Heat", "Humidity", "All of the above"], correct: 3 },
            { id: 47, chapter: 4, question: "What important lesson do they learn?", options: ["Nature needs protection", "Adventure is fun", "Animals are scary", "Trees are tall"], correct: 0 },
            { id: 48, chapter: 4, question: "How do they return home this time?", options: ["Helicopter", "Boat", "Magic tree house", "Walking"], correct: 2 },

            // Chapter 5 (12문제)
            { id: 49, chapter: 5, question: "Where is their final adventure in this book?", options: ["Titanic", "Moon", "Wild West", "Ancient China"], correct: 0 },
            { id: 50, chapter: 5, question: "What is special about the Titanic adventure?", options: ["Very dangerous", "Historical disaster", "Many people", "All of the above"], correct: 3 },
            { id: 51, chapter: 5, question: "Who do they meet on the Titanic?", options: ["Captain", "Passengers", "Crew members", "All of the above"], correct: 3 },
            { id: 52, chapter: 5, question: "What do they know will happen to the ship?", options: ["Nothing", "Will sink", "Will get lost", "Will be attacked"], correct: 1 },
            { id: 53, chapter: 5, question: "How do they try to help?", options: ["Warn people", "Help with lifeboats", "Stay calm", "All of the above"], correct: 3 },
            { id: 54, chapter: 5, question: "What do they learn about courage?", options: ["Only adults are brave", "Anyone can be brave", "Courage is scary", "Courage is easy"], correct: 1 },
            { id: 55, chapter: 5, question: "How do people on the ship behave?", options: ["All panic", "Some brave, some scared", "Everyone calm", "Everyone fights"], correct: 1 },
            { id: 56, chapter: 5, question: "What do Jack and Annie do to help?", options: ["Nothing", "Help children", "Cause trouble", "Hide"], correct: 1 },
            { id: 57, chapter: 5, question: "How do they escape the sinking ship?", options: ["Lifeboat", "Magic tree house appears", "Swimming", "Helicopter"], correct: 1 },
            { id: 58, chapter: 5, question: "What do they learn from all their adventures?", options: ["History is boring", "World is amazing and full of lessons", "Time travel is easy", "Books are better"], correct: 1 },
            { id: 59, chapter: 5, question: "How do they feel about the tree house now?", options: ["Scared", "Grateful and excited", "Bored", "Confused"], correct: 1 },
            { id: 60, chapter: 5, question: "What is the main theme of Magic Tree House?", options: ["Magic is real", "Learning through adventure", "Siblings fighting", "School is important"], correct: 1 }
        ];

        // ================ 테스트 실행 로직 ================
        let currentQuestionIndex = 0;
        let userAnswers = new Array(60);
        let timeRemaining = 90 * 60; // 90분
        let timerInterval;
        let answerChecked = false;

        // 초기화
        function init() {
            showQuestion(0);
            startTimer();
            
            // 페이지 나가기 방지
            window.addEventListener('beforeunload', function(e) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            });
        }

        // 타이머 시작
        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();

                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    autoSubmitTest();
                }
            }, 1000);
        }

        // 타이머 표시 업데이트
        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const timerElement = document.getElementById('timer');

            timerElement.textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            if (timeRemaining <= 600) {
                timerElement.style.background = 'linear-gradient(45deg, #dc3545, #c82333)';
            }
        }

        // 문제 표시
        function showQuestion(index) {
            currentQuestionIndex = index;
            answerChecked = false;
            const question = allQuestions[index];

            // 문제 정보 업데이트
            document.getElementById('current-question').textContent = index + 1;
            document.getElementById('question-number').textContent = `문제 ${index + 1}`;
            document.getElementById('chapter-info').textContent = `Chapter ${question.chapter}`;
            document.getElementById('current-chapter').textContent = `Ch.${question.chapter}`;

            // 문제 텍스트
            document.getElementById('question-text').textContent = question.question;

            // 선택지 생성
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, optIndex) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.onclick = () => selectOption(optIndex);

                optionDiv.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + optIndex)}</div>
                    <div class="option-text">${option}</div>
                `;

                optionsContainer.appendChild(optionDiv);
            });

            // 정답 섹션 숨기기
            document.getElementById('answer-section').classList.remove('show');

            // 버튼 상태 업데이트
            updateButtonStates();

            // 통계 업데이트
            updateStats();

            // 이전 답변 복원
            if (userAnswers[index] !== undefined) {
                restoreAnswer(userAnswers[index]);
            }
        }

        // 선택지 선택
        function selectOption(optionIndex) {
            if (answerChecked) return;

            // 이전 선택 해제
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));

            // 새 선택 적용
            document.querySelectorAll('.option')[optionIndex].classList.add('selected');

            // 답변 저장
            userAnswers[currentQuestionIndex] = optionIndex;

            // 통계 업데이트
            updateStats();

            // 정답 확인 버튼 활성화
            document.getElementById('check-btn').disabled = false;
        }

        // 정답 확인
        function checkAnswer() {
            if (userAnswers[currentQuestionIndex] === undefined) {
                alert('답을 선택해주세요!');
                return;
            }

            answerChecked = true;
            const question = allQuestions[currentQuestionIndex];
            const userAnswer = userAnswers[currentQuestionIndex];
            const isCorrect = userAnswer === question.correct;

            // 선택지 스타일 업데이트
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                option.onclick = null; // 클릭 비활성화
                
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === userAnswer && !isCorrect) {
                    option.classList.add('wrong');
                }
            });

            // 정답 피드백 표시
            showAnswerFeedback(isCorrect, question);

            // 버튼 상태 업데이트
            updateButtonStates();
        }

        // 정답 피드백 표시
        function showAnswerFeedback(isCorrect, question) {
            const answerSection = document.getElementById('answer-section');
            const feedback = document.getElementById('answer-feedback');
            
            feedback.innerHTML = `
                <div class="feedback-icon ${isCorrect ? 'correct-icon' : 'wrong-icon'}">
                    ${isCorrect ? '✓' : '✗'}
                </div>
                <div style="flex: 1;">
                    <strong>${isCorrect ? '정답입니다!' : '틀렸습니다.'}</strong><br>
                    <small>정답: ${String.fromCharCode(65 + question.correct)} - ${question.options[question.correct]}</small>
                </div>
            `;

            answerSection.classList.add('show');
        }

        // 이전 답변 복원
        function restoreAnswer(answerIndex) {
            const options = document.querySelectorAll('.option');
            if (options[answerIndex]) {
                options[answerIndex].classList.add('selected');
            }
        }

        // 버튼 상태 업데이트
        function updateButtonStates() {
            const checkBtn = document.getElementById('check-btn');
            const nextBtn = document.getElementById('next-btn');
            const prevBtn = document.getElementById('prev-btn');

            if (answerChecked) {
                checkBtn.style.display = 'none';
                nextBtn.style.display = 'block';
                
                if (currentQuestionIndex === 59) {
                    nextBtn.textContent = '제출하기 📤';
                    nextBtn.className = 'nav-btn submit-btn';
                } else {
                    nextBtn.textContent = '다음 문제 ➡️';
                    nextBtn.className = 'nav-btn next-btn';
                }
            } else {
                checkBtn.style.display = 'block';
                nextBtn.style.display = 'none';
                checkBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
            }

            prevBtn.disabled = currentQuestionIndex === 0;
        }

        // 통계 업데이트
        function updateStats() {
            const answeredCount = userAnswers.filter(answer => answer !== undefined).length;
            const remainingCount = 60 - answeredCount;
            const progressPercent = ((currentQuestionIndex + 1) / 60 * 100).toFixed(1);

            document.getElementById('answered-count').textContent = answeredCount;
            document.getElementById('remaining-count').textContent = remainingCount;
            document.getElementById('progress-percent').textContent = `${progressPercent}%`;
            document.getElementById('progress-display').textContent = 
                `${currentQuestionIndex + 1}/60 (${progressPercent}%)`;

            // 진행률 바 업데이트
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = `${(currentQuestionIndex + 1) / 60 * 100}%`;
        }

        // 이전 문제
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                showQuestion(currentQuestionIndex - 1);
            }
        }

        // 다음 문제
        function nextQuestion() {
            if (currentQuestionIndex === 59) {
                showSubmitModal();
            } else {
                showQuestion(currentQuestionIndex + 1);
            }
        }

        // 제출 확인 모달
        function showSubmitModal() {
            const answeredCount = userAnswers.filter(answer => answer !== undefined).length;
            const unansweredCount = 60 - answeredCount;

            if (confirm(`테스트를 제출하시겠습니까?\n\n답변 완료: ${answeredCount}개\n미답변: ${unansweredCount}개\n\n제출 후에는 수정할 수 없습니다.`)) {
                submitTest();
            }
        }

        // 테스트 제출
        function submitTest() {
            clearInterval(timerInterval);
            
            // 결과 계산
            let correctAnswers = 0;
            allQuestions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) {
                    correctAnswers++;
                }
            });

            const percentage = Math.round((correctAnswers / 60) * 100);
            
            alert(`테스트 완료!\n\n정답: ${correctAnswers}/60\n점수: ${percentage}%\n\n결과를 분석 중입니다...`);
            
            // 실제로는 결과 페이지로 이동
            // window.location.href = '/level-test/result';
        }

        // 자동 제출 (시간 초과)
        function autoSubmitTest() {
            alert('시간이 종료되었습니다. 자동으로 제출됩니다.');
            submitTest();
        }

        // 페이지 로드 시 초기화
        window.addEventListener('load', init);
    </script>
</body>
</html>
